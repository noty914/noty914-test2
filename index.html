<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Live Setlist Maker</title>
    
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- lz-string -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Styles -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&family=Noto+Sans+JP:wght@300;400;500;700&display=swap');
        body { font-family: 'Inter', 'Noto Sans JP', sans-serif; background-color: #111827; }
        .glass-panel { backdrop-filter: blur(10px); border-width: 1px; border-style: solid; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 selection:bg-pink-500 selection:text-white">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // アイコン (SVG)
        const IconMusic = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-pink-500 w-6 h-6"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>;
        const IconSearch = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-4 h-4 mr-1.5"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>;
        const IconPlus = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>;
        const IconArrowLeft = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>;
        const IconCalendar = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-4 h-4 mr-1"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>;
        const IconMapPin = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-red-400 w-4 h-4 mr-2"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>;
        const IconTrash2 = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-5 h-5"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>;
        const IconInfo = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-3 h-3 mr-1 opacity-70"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>;
        const IconCopy = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-5 h-5 mr-2"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>;
        const IconCheck = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-5 h-5 mr-2"><path d="M20 6 9 17l-5-5"/></svg>;
        const IconTwitter = () => <svg className="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84" /></svg>;
        const IconExternalLink = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-3 h-3 ml-1 opacity-50"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></svg>;
        const IconDisc = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-4 h-4"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></svg>;
        const IconYoutube = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-4 h-4"><path d="M2.5 17a24.12 24.12 0 0 1 0-10 2 2 0 0 1 1.4-1.4 49.56 49.56 0 0 1 16.2 0A2 2 0 0 1 21.5 7a24.12 24.12 0 0 1 0 10 2 2 0 0 1-1.4 1.4 49.55 49.55 0 0 1-16.2 0A2 2 0 0 1 2.5 17"/><path d="m10 15 5-3-5-3z"/></svg>;
        const IconChevronDown = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-5 h-5 opacity-50 group-hover:opacity-100"><path d="m6 9 6 6 6-6"/></svg>;
        const IconChevronUp = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-5 h-5"><path d="m18 15-6-6-6 6"/></svg>;
        const IconPenTool = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-3 h-3 mr-1 opacity-50"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>;
        const IconSave = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-4 h-4 mr-1"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>;
        const IconX = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-4 h-4"><path d="M18 6 6 18"/><path d="m6 6 18 18"/></svg>;
        const IconEdit3 = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-3 h-3 mr-1"><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/></svg>;
        const IconGripVertical = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-4 h-4 mx-auto"><circle cx="9" cy="12" r="1"/><circle cx="9" cy="5" r="1"/><circle cx="9" cy="19" r="1"/><circle cx="15" cy="12" r="1"/><circle cx="15" cy="5" r="1"/><circle cx="15" cy="19" r="1"/></svg>;
        const IconPlusCircle = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-4 h-4 mr-1"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>;
        const IconUpload = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-4 h-4 mr-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>;
        const IconSun = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>;
        const IconMoon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>;
        const IconLink = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-3 h-3 mr-1"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>;
        const IconUser = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-4 h-4 mr-1"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
        const IconUsers = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-4 h-4 mr-1"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>;

        // --- データ ---
        const SAMPLE_DATA = {
            id: 1,
            title: "RADWIMPS BACK TO THE LIVE HOUSE TOUR 2023",
            date: "2023-06-22",
            venue: "KT Zepp Yokohama",
            prefecture: "神奈川県",
            artistImage: "https://placehold.co/600x200/1f2937/ec4899?text=RADWIMPS",
            acts: [
                {
                    artistName: "RADWIMPS",
                    type: "Main",
                    songs: [
                        { order: 1, title: "ココロノナカ", memo: "" },
                        { order: 2, title: "なんちって", memo: "" },
                        { order: 3, title: "ソクラティックラブ", memo: "" },
                        { order: 4, title: "ます。", memo: "" },
                        { order: 5, title: "ハイパーベンチレイション", memo: "" },
                        { order: 6, title: "指切りげんまん", memo: "" },
                        { order: 7, title: "me me she", memo: "" },
                        { order: 8, title: "かたわれ時", memo: "" },
                        { order: 9, title: "そっけない", memo: "" },
                        { order: 10, title: "ヒキコモリロリン", memo: "" },
                        { order: 11, title: "俺色スカイ", memo: "" },
                        { order: 12, title: "Tamaki", memo: "" },
                        { order: 13, title: "オーダーメイド", memo: "" },
                        { order: 14, title: "すずめ feat.十明", memo: "" },
                        { order: 15, title: "億万笑者", memo: "" },
                        { order: 16, title: "有心論", memo: "" },
                        { order: 17, title: "会心の一撃", memo: "本編ラスト！最高潮！" },
                        { order: "En1", title: "ギミギミック", memo: "" },
                        { order: "En2", title: "One man live", memo: "" },
                        { order: "En3", title: "DADA", memo: "" }
                    ]
                }
            ]
        };

        // --- 圧縮・復元ロジック (LZString使用) ---
        const minifyData = (data) => ({
            t: data.title,
            d: data.date,
            v: data.venue,
            a: data.acts.map(act => ({
                n: act.artistName,
                k: act.type, 
                s: act.songs.map(song => ({
                    o: song.order,
                    t: song.title,
                    m: song.memo
                }))
            }))
        });

        const unminifyData = (minified) => ({
            title: minified.t,
            date: minified.d,
            venue: minified.v,
            artistImage: null, 
            acts: minified.a.map(act => ({
                artistName: act.n,
                type: act.k,
                songs: act.s.map(song => ({
                    order: song.o,
                    title: song.t,
                    memo: song.m
                }))
            }))
        });

        const encodeData = (data) => {
            try {
                if (typeof LZString === 'undefined') return null;
                const minified = minifyData(data);
                const json = JSON.stringify(minified);
                return LZString.compressToEncodedURIComponent(json);
            } catch (e) {
                console.error("Encode failed", e);
                return null;
            }
        };

        const decodeData = (encoded) => {
            try {
                if (typeof LZString === 'undefined') return null;
                const json = LZString.decompressFromEncodedURIComponent(encoded);
                if (!json) return null;
                const minified = JSON.parse(json);
                return unminifyData(minified);
            } catch (e) {
                console.error("Decode failed", e);
                return null;
            }
        };

        const resizeImage = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const maxWidth = 800;
                        const scaleSize = maxWidth / img.width;
                        const width = (scaleSize < 1) ? maxWidth : img.width;
                        const height = (scaleSize < 1) ? img.height * scaleSize : img.height;
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        resolve(canvas.toDataURL('image/jpeg', 0.7));
                    };
                    img.onerror = (error) => reject(error);
                };
                reader.onerror = (error) => reject(error);
            });
        };

        // --- Main App ---
        const App = () => {
            const [view, setView] = useState('home');
            const [setlists, setSetlists] = useState([]);
            const [selectedSetlistId, setSelectedSetlistId] = useState(null);
            const [isDarkMode, setIsDarkMode] = useState(true);

            // Load Data
            useEffect(() => {
                try {
                    const saved = localStorage.getItem('my_setlists_v12');
                    if (saved) {
                        setSetlists(JSON.parse(saved));
                    } else {
                        setSetlists([SAMPLE_DATA]);
                    }
                } catch (e) {
                    console.error(e);
                    setSetlists([SAMPLE_DATA]);
                }

                const params = new URLSearchParams(window.location.search);
                const sharedData = params.get('share');
                if (sharedData && typeof LZString !== 'undefined') {
                    const decoded = decodeData(sharedData);
                    if (decoded) {
                        if (window.confirm(`共有されたセットリスト「${decoded.title}」をインポートしますか？`)) {
                            const newSetlist = { ...decoded, id: Date.now() };
                            setSetlists(prev => [newSetlist, ...prev]);
                            window.history.replaceState(null, '', window.location.pathname);
                        }
                    }
                }
            }, []);

            // Save Data
            useEffect(() => {
                try {
                    if (setlists.length > 0) {
                        localStorage.setItem('my_setlists_v12', JSON.stringify(setlists));
                    }
                } catch (e) { console.error(e); }
            }, [setlists]);

            const handleCreate = (newSetlist) => {
                const setlistWithId = { ...newSetlist, id: Date.now() };
                setSetlists([setlistWithId, ...setlists]);
                setView('home');
            };

            const handleUpdateSetlist = (updatedSetlist) => {
                const newSetlists = setlists.map(s => s.id === updatedSetlist.id ? updatedSetlist : s);
                setSetlists(newSetlists);
            };

            const handleDelete = (e, id) => {
                e.stopPropagation();
                if(confirm('本当に削除しますか？')) {
                    setSetlists(setlists.filter(s => s.id !== id));
                }
            };

            const handleSelect = (setlist) => {
                setSelectedSetlistId(setlist.id);
                setView('detail');
            };

            const selectedSetlist = setlists.find(s => s.id === selectedSetlistId);

            const theme = {
                isDarkMode,
                bg: isDarkMode ? "bg-gray-900" : "bg-gray-50",
                text: isDarkMode ? "text-gray-100" : "text-gray-900",
                subText: isDarkMode ? "text-gray-400" : "text-gray-500",
                cardBg: isDarkMode ? "bg-gray-800/60 border-gray-700" : "bg-white/80 border-gray-200 shadow-sm",
                header: isDarkMode ? "from-blue-900 via-purple-900 to-gray-900 border-white/10" : "from-blue-600 via-purple-600 to-gray-800 border-transparent",
                input: isDarkMode ? "bg-gray-800 border-gray-700 text-white focus:border-pink-500" : "bg-white border-gray-300 text-gray-900 focus:border-pink-500",
                buttonSecondary: isDarkMode ? "bg-gray-700 hover:bg-gray-600 text-white" : "bg-gray-200 hover:bg-gray-300 text-gray-800",
                divider: isDarkMode ? "border-gray-800" : "border-gray-200", 
                encoreBg: isDarkMode ? "bg-[#111827] border-gray-800" : "bg-white border-gray-200",
                hoverBg: isDarkMode ? "hover:bg-white/5" : "hover:bg-gray-100",
            };

            return (
                <div className={`min-h-screen pb-12 font-sans selection:bg-pink-500 selection:text-white ${theme.bg} ${theme.text} transition-colors duration-300`}>
                    <header className={`bg-gradient-to-r ${theme.header} shadow-lg sticky top-0 z-50 border-b transition-colors duration-300`}>
                        <div className="max-w-3xl mx-auto px-4 py-4 flex justify-between items-center">
                            <div className="flex items-center space-x-2 cursor-pointer" onClick={() => setView('home')}>
                                <IconMusic />
                                <h1 className="text-xl font-bold text-white tracking-wider">My Setlist Maker</h1>
                            </div>
                            <div className="flex items-center space-x-3">
                                <button onClick={() => setIsDarkMode(!isDarkMode)} className="p-2 rounded-full bg-white/10 hover:bg-white/20 text-white transition">
                                    {isDarkMode ? <IconSun /> : <IconMoon />}
                                </button>
                                {view === 'home' && (
                                    <button onClick={() => setView('create')} className="bg-pink-600 hover:bg-pink-500 text-white px-4 py-2 rounded-full text-sm font-bold flex items-center transition shadow-lg">
                                        <IconPlus /><span className="ml-1">新規作成</span>
                                    </button>
                                )}
                            </div>
                        </div>
                    </header>

                    <main className="max-w-3xl mx-auto px-4 mt-6">
                        {view === 'home' && <HomeView setlists={setlists} onSelect={handleSelect} onDelete={handleDelete} theme={theme} />}
                        {view === 'create' && <CreateView onSave={handleCreate} onCancel={() => setView('home')} theme={theme} />}
                        {view === 'detail' && selectedSetlist && <DetailView data={selectedSetlist} onUpdate={handleUpdateSetlist} onBack={() => setView('home')} theme={theme} />}
                    </main>
                </div>
            );
        };

        // --- Components ---
        const HomeView = ({ setlists, onSelect, onDelete, theme }) => {
            return (
                <div className="animate-fade-in">
                    <h2 className={`text-2xl font-bold mb-6 ${theme.text}`}>あなたのセットリスト</h2>
                    {setlists.length === 0 ? (
                        <div className={`text-center py-10 ${theme.subText}`}>まだセットリストがありません。「新規作成」から作りましょう！</div>
                    ) : (
                        <div className="grid gap-4">
                            {setlists.map(item => (
                                <div key={item.id} onClick={() => onSelect(item)} className={`glass-panel p-5 rounded-xl ${theme.cardBg} ${theme.hoverBg} transition cursor-pointer group relative`}>
                                    <div className="flex justify-between items-start">
                                        <div className="flex-1">
                                            <div className={`flex items-center text-xs ${theme.subText} mb-1`}>
                                                <IconCalendar /> <span className="ml-1">{item.date}</span>
                                                <span className="mx-2">|</span>
                                                <IconMapPin /> <span className="ml-1">{item.venue}</span>
                                            </div>
                                            <h3 className={`text-xl font-bold group-hover:text-pink-500 transition ${theme.text}`}>{item.title}</h3>
                                            <div className={`mt-2 text-sm ${theme.subText} flex items-center`}>
                                                {item.artistImage ? (
                                                    <img src={item.artistImage} alt="artist" className="w-6 h-6 rounded-full mr-2 object-cover shadow-sm" />
                                                ) : (
                                                    <span className={`w-6 h-6 rounded-full mr-2 flex items-center justify-center ${theme.buttonSecondary}`}><IconMusic /></span>
                                                )}
                                                <div className="flex flex-wrap gap-1">
                                                    {item.acts.map((act, idx) => (
                                                        <span key={idx}>{act.artistName}{idx < item.acts.length - 1 && <span className="mx-1 opacity-50">/</span>}</span>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                        <button onClick={(e) => onDelete(e, item.id)} className="text-gray-400 hover:text-red-500 p-2 transition z-10 ml-2"><IconTrash2 /></button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        const CreateView = ({ onSave, onCancel, theme }) => {
            const [title, setTitle] = useState('');
            const [date, setDate] = useState('');
            const [venue, setVenue] = useState('');
            const [artistImage, setArtistImage] = useState('');
            const [mainArtistName, setMainArtistName] = useState('');
            const [mainSongText, setMainSongText] = useState('');
            const [hasGuest, setHasGuest] = useState(false);
            const [guestArtistName, setGuestArtistName] = useState('');
            const [guestSongText, setGuestSongText] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            const handleImageChange = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    setIsLoading(true);
                    try {
                        const base64 = await resizeImage(file);
                        setArtistImage(base64);
                    } catch (error) { alert("画像の処理に失敗しました。"); }
                    setIsLoading(false);
                }
            };

            const parseSongText = (text) => {
                const lines = text.split('\n');
                const songs = [];
                let isEncore = false, mainCount = 0, enCount = 0;
                lines.forEach(line => {
                    const trimLine = line.trim();
                    if (!trimLine) { if (songs.length > 0) isEncore = true; return; }
                    if (isEncore) { enCount++; songs.push({ order: `En${enCount}`, title: trimLine, memo: '' }); }
                    else { mainCount++; songs.push({ order: mainCount, title: trimLine, memo: '' }); }
                });
                return songs;
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!title || !mainArtistName) return;
                if (hasGuest && !guestArtistName) { alert("ゲストアーティスト名を入力してください"); return; }

                const acts = [];
                if (hasGuest) acts.push({ artistName: guestArtistName, type: "Guest", songs: parseSongText(guestSongText) });
                acts.push({ artistName: mainArtistName, type: "Main", songs: parseSongText(mainSongText) });

                onSave({ title, date: date || '日付未定', venue: venue || '会場未定', artistImage: artistImage || null, prefecture: '', acts });
            };

            return (
                <div className="animate-fade-in">
                    <button onClick={onCancel} className={`mb-4 flex items-center text-sm hover:opacity-80 ${theme.subText}`}><IconArrowLeft /><span className="ml-1">戻る</span></button>
                    <div className={`glass-panel p-6 rounded-xl ${theme.cardBg}`}>
                        <h2 className={`text-xl font-bold mb-6 ${theme.text}`}>新しいセットリストを作成</h2>
                        <form onSubmit={handleSubmit} className="space-y-6">
                            <div className="space-y-4">
                                <div><label className={`block text-sm mb-1 ${theme.subText}`}>イベントタイトル <span className="text-red-500">*</span></label><input type="text" required className={`w-full rounded p-2 outline-none ${theme.input}`} value={title} onChange={e => setTitle(e.target.value)} placeholder="例: RADWIMPS BACK TO THE LIVE HOUSE TOUR 2023" /></div>
                                <div className="grid grid-cols-2 gap-4">
                                    <div><label className={`block text-sm mb-1 ${theme.subText}`}>日付</label><input type="date" className={`w-full rounded p-2 outline-none ${theme.input}`} value={date} onChange={e => setDate(e.target.value)} /></div>
                                    <div><label className={`block text-sm mb-1 ${theme.subText}`}>会場</label><input type="text" className={`w-full rounded p-2 outline-none ${theme.input}`} value={venue} onChange={e => setVenue(e.target.value)} placeholder="例: KT Zepp Yokohama" /></div>
                                </div>
                                <div>
                                    <label className={`block text-sm mb-1 ${theme.subText}`}>ヘッダー画像 (任意)</label>
                                    <div className="flex items-center space-x-4">
                                        <label className={`cursor-pointer py-2 px-4 rounded flex items-center text-sm transition ${theme.buttonSecondary}`}><IconUpload /> <span className="ml-2">画像を選択</span><input type="file" accept="image/*" className="hidden" onChange={handleImageChange} /></label>
                                        {isLoading && <span className={`text-xs ${theme.subText}`}>処理中...</span>}
                                        {artistImage && (<div className={`relative w-16 h-10 overflow-hidden rounded border ${theme.divider.replace('border-', 'border-')}`}><img src={artistImage} alt="preview" className="w-full h-full object-cover" /></div>)}
                                    </div>
                                </div>
                            </div>
                            <div className={`h-px ${theme.isDarkMode ? 'bg-gray-700' : 'bg-gray-300'}`}></div>
                            <div className="space-y-4">
                                <div className="flex items-center"><input type="checkbox" id="hasGuest" checked={hasGuest} onChange={e => setHasGuest(e.target.checked)} className="w-4 h-4 rounded border-gray-600 text-pink-600 focus:ring-pink-500" /><label htmlFor="hasGuest" className={`ml-2 text-sm font-medium ${theme.text}`}>ゲストアーティスト（対バン）を追加する</label></div>
                                {hasGuest && (
                                    <div className={`p-4 rounded-lg border ${theme.isDarkMode ? 'border-gray-700 bg-gray-800/50' : 'border-gray-200 bg-gray-50'}`}>
                                        <h3 className={`text-sm font-bold mb-3 flex items-center ${theme.text}`}><IconUsers /> <span className="ml-1">Guest Act</span></h3>
                                        <div className="space-y-3">
                                            <div><input type="text" required={hasGuest} className={`w-full rounded p-2 outline-none ${theme.input}`} value={guestArtistName} onChange={e => setGuestArtistName(e.target.value)} placeholder="ゲストアーティスト名" /></div>
                                            <div><textarea className={`w-full rounded p-2 outline-none h-32 leading-relaxed ${theme.input}`} value={guestSongText} onChange={e => setGuestSongText(e.target.value)} placeholder="ゲストのセットリストを入力"></textarea></div>
                                        </div>
                                    </div>
                                )}
                            </div>
                            <div className={`p-4 rounded-lg border ${theme.isDarkMode ? 'border-pink-900/30 bg-pink-900/10' : 'border-pink-100 bg-pink-50'}`}>
                                <h3 className={`text-sm font-bold mb-3 flex items-center ${theme.text}`}><IconUser /> <span className="ml-1">Main Act</span></h3>
                                <div className="space-y-3">
                                    <div><label className={`block text-xs mb-1 ${theme.subText}`}>メインアーティスト名 <span className="text-red-500">*</span></label><input type="text" required className={`w-full rounded p-2 outline-none ${theme.input}`} value={mainArtistName} onChange={e => setMainArtistName(e.target.value)} placeholder="例: RADWIMPS" /></div>
                                    <div>
                                        <label className={`block text-xs mb-1 ${theme.subText}`}>セットリスト (1行に1曲)</label>
                                        <p className={`text-xs mb-2 ${theme.subText}`}>※空行を挟むと、そこからアンコール（En1〜）になります。</p>
                                        <textarea className={`w-full rounded p-2 outline-none h-64 leading-relaxed ${theme.input}`} value={mainSongText} onChange={e => setMainSongText(e.target.value)} placeholder="曲名1&#13;&#10;曲名2&#13;&#10;&#13;&#10;アンコール曲1&#13;&#10;アンコール曲2"></textarea>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" disabled={isLoading} className="w-full bg-pink-600 hover:bg-pink-500 text-white font-bold py-3 rounded-lg transition mt-4 disabled:opacity-50 shadow-md">保存する</button>
                        </form>
                    </div>
                </div>
            );
        };

        const ShareModal = ({ isOpen, onClose, url, theme }) => {
            const [copied, setCopied] = useState(false);
            if (!isOpen) return null;
            const handleCopy = () => {
                const textArea = document.createElement("textarea");
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                try { document.execCommand('copy'); setCopied(true); setTimeout(() => setCopied(false), 2000); } catch (err) {}
                document.body.removeChild(textArea);
            };
            return (
                <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
                    <div className={`w-full max-w-md rounded-xl p-6 shadow-2xl ${theme.cardBg} ${theme.isDarkMode ? 'bg-gray-900 border-gray-700' : 'bg-white border-gray-200'} border`}>
                        <div className="flex justify-between items-center mb-4"><h3 className={`text-lg font-bold ${theme.text}`}>共有用リンクを発行</h3><button onClick={onClose} className="text-gray-400 hover:text-gray-500"><IconX /></button></div>
                        <p className={`text-sm mb-4 ${theme.subText}`}>以下のリンクをコピーして、SNSなどで共有してください。<br/><span className="text-xs opacity-70">※画像データは共有されません（テキスト情報のみ）。</span></p>
                        <div className="flex items-center space-x-2 mb-6"><input type="text" readOnly value={url} className={`flex-1 rounded px-3 py-2 text-sm outline-none select-all ${theme.input}`} /><button onClick={handleCopy} className={`flex items-center justify-center px-4 py-2 rounded font-bold transition ${copied ? 'bg-green-600 text-white' : 'bg-blue-600 hover:bg-blue-500 text-white'}`}>{copied ? <IconCheck /> : <IconCopy />}</button></div>
                        <div className="text-center"><button onClick={onClose} className={`text-sm ${theme.subText} hover:underline`}>閉じる</button></div>
                    </div>
                </div>
            );
        };

        const DetailView = ({ data, onUpdate, onBack, theme }) => {
            const [expandedSong, setExpandedSong] = useState(null);
            const [isEditing, setIsEditing] = useState(false);
            const [editData, setEditData] = useState(null);
            const [isLoading, setIsLoading] = useState(false);
            const [showShareModal, setShowShareModal] = useState(false);
            const [shareUrl, setShareUrl] = useState('');

            const handleCreateShareLink = () => {
                const { artistImage, ...shareableData } = data;
                const encoded = encodeData(shareableData);
                if (encoded) {
                    const url = `${window.location.origin}${window.location.pathname}?share=${encoded}`;
                    setShareUrl(url);
                    setShowShareModal(true);
                } else { alert("データのサイズが大きすぎてリンクを発行できませんでした。"); }
            };

            const startEditing = () => {
                const actsWithDividers = data.acts.map(act => {
                    const songsWithDivider = [];
                    let insertedDivider = false;
                    act.songs.forEach(song => {
                        if (!insertedDivider && String(song.order).startsWith('En')) { songsWithDivider.push({ isDivider: true, id: 'divider-item' }); insertedDivider = true; }
                        songsWithDivider.push({ ...song, isDivider: false, id: Math.random().toString(36).substr(2, 9) });
                    });
                    if (!insertedDivider) songsWithDivider.push({ isDivider: true, id: 'divider-item' });
                    return { ...act, songs: songsWithDivider };
                });
                setEditData({ ...data, acts: actsWithDividers });
                setIsEditing(true);
            };

            const saveEditing = () => {
                const cleanedActs = editData.acts.map(act => {
                    const newSongs = [];
                    let isEncore = false, mainCount = 0, enCount = 0;
                    act.songs.forEach(song => {
                        if (song.isDivider) { isEncore = true; return; }
                        let newOrder;
                        if (isEncore) { enCount++; newOrder = `En${enCount}`; } else { mainCount++; newOrder = mainCount; }
                        const { id, isDivider, ...cleanSong } = song;
                        newSongs.push({ ...cleanSong, order: newOrder });
                    });
                    return { ...act, songs: newSongs };
                });
                onUpdate({ ...editData, acts: cleanedActs });
                setIsEditing(false);
            };

            const moveSong = (actIndex, fromIndex, direction) => {
                const toIndex = fromIndex + direction;
                const songs = [...editData.acts[actIndex].songs];
                if (toIndex < 0 || toIndex >= songs.length) return;
                const [movedItem] = songs.splice(fromIndex, 1);
                songs.splice(toIndex, 0, movedItem);
                const newActs = [...editData.acts];
                newActs[actIndex] = { ...newActs[actIndex], songs };
                setEditData({ ...editData, acts: newActs });
            };

            const addSong = (actIndex) => {
                const newSong = { title: "", memo: "", isDivider: false, id: Math.random().toString(36).substr(2, 9) };
                const newActs = [...editData.acts];
                newActs[actIndex].songs.push(newSong);
                setEditData({ ...editData, acts: newActs });
            };

            const removeSong = (actIndex, songIndex) => {
                const newActs = [...editData.acts];
                newActs[actIndex].songs.splice(songIndex, 1);
                setEditData({ ...editData, acts: newActs });
            };

            const addAct = () => {
                const newActs = [...editData.acts, { artistName: "", type: "Guest", songs: [] }];
                setEditData({ ...editData, acts: newActs });
            };

            const removeAct = (actIndex) => {
                if (editData.acts.length <= 1) return;
                const newActs = [...editData.acts];
                newActs.splice(actIndex, 1);
                setEditData({ ...editData, acts: newActs });
            };

            const handleEditChange = (field, value, actIndex = null, songIndex = null) => {
                if (actIndex === null) { setEditData({ ...editData, [field]: value }); }
                else if (songIndex === null) { const newActs = [...editData.acts]; newActs[actIndex][field] = value; setEditData({ ...editData, acts: newActs }); }
                else { const newActs = [...editData.acts]; newActs[actIndex].songs[songIndex][field] = value; setEditData({ ...editData, acts: newActs }); }
            };

            const handleEditImageChange = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    setIsLoading(true);
                    try {
                        const base64 = await resizeImage(file);
                        setEditData({ ...editData, artistImage: base64 });
                    } catch (error) { alert("画像の処理に失敗しました。"); }
                    setIsLoading(false);
                }
            };

            const toggleSong = (actIndex, songIndex) => {
                if (isEditing) return;
                const id = `${actIndex}-${songIndex}`;
                setExpandedSong(expandedSong === id ? null : id);
            };

            const handleMemoChange = (actIndex, songIndex, newMemo) => {
                const newData = { ...data };
                newData.acts[actIndex].songs[songIndex].memo = newMemo;
                onUpdate(newData);
            };

            const getSearchLinks = (artist, title) => {
                const query = encodeURIComponent(`${artist} ${title}`);
                return [
                    { name: 'Spotify', url: `https://open.spotify.com/search/${query}`, icon: <IconDisc />, color: 'hover:text-green-400 border-gray-500 hover:border-green-400' },
                    { name: 'Apple Music', url: `https://music.apple.com/jp/search?term=${query}`, icon: <IconMusic />, color: 'hover:text-pink-400 border-gray-500 hover:border-pink-400' },
                    { name: 'YouTube', url: `https://www.youtube.com/results?search_query=${query}`, icon: <IconYoutube />, color: 'hover:text-red-400 border-gray-500 hover:border-red-400' },
                ];
            };

            return (
                <div className="animate-fade-in">
                    <ShareModal isOpen={showShareModal} onClose={() => setShowShareModal(false)} url={shareUrl} theme={theme} />
                    <div className="flex justify-between items-center mb-4">
                        <button onClick={onBack} className={`flex items-center text-sm hover:opacity-80 ${theme.subText}`}><IconArrowLeft /><span className="ml-1">一覧に戻る</span></button>
                        <div>
                            {isEditing ? (
                                <div className="flex space-x-2">
                                    <button onClick={() => setIsEditing(false)} className={`px-3 py-1 rounded text-sm hover:opacity-80 ${theme.subText}`}>キャンセル</button>
                                    <button onClick={saveEditing} disabled={isLoading} className="bg-green-600 hover:bg-green-500 text-white px-4 py-1 rounded-full text-sm flex items-center font-bold disabled:opacity-50 shadow-md"><IconSave /><span className="ml-1">保存</span></button>
                                </div>
                            ) : (
                                <div className="flex space-x-2">
                                    <button onClick={handleCreateShareLink} className={`px-4 py-1 rounded-full text-sm flex items-center shadow-sm bg-blue-600 hover:bg-blue-500 text-white`} title="共有用リンクを発行"><IconLink /><span className="ml-1">共有</span></button>
                                    <button onClick={startEditing} className={`px-4 py-1 rounded-full text-sm flex items-center shadow-sm ${theme.buttonSecondary}`}><IconEdit3 /><span className="ml-1">編集</span></button>
                                </div>
                            )}
                        </div>
                    </div>
                    {isEditing ? (
                        <div className={`glass-panel p-6 rounded-xl mb-8 space-y-4 border-pink-500/50 ${theme.cardBg}`}>
                            <div className="text-pink-500 text-sm font-bold">セットリスト情報の編集</div>
                            <input type="text" className={`w-full rounded p-2 outline-none ${theme.input}`} value={editData.title} onChange={(e) => handleEditChange('title', e.target.value)} placeholder="イベントタイトル" />
                            <div className="grid grid-cols-2 gap-4">
                                <input type="date" className={`w-full rounded p-2 outline-none ${theme.input}`} value={editData.date} onChange={(e) => handleEditChange('date', e.target.value)} />
                                <input type="text" className={`w-full rounded p-2 outline-none ${theme.input}`} value={editData.venue} onChange={(e) => handleEditChange('venue', e.target.value)} placeholder="会場" />
                            </div>
                            <div className="flex items-center space-x-4">
                                <label className={`cursor-pointer py-2 px-4 rounded flex items-center text-sm transition ${theme.buttonSecondary}`}><IconUpload /> <span className="ml-2">画像を変更</span><input type="file" accept="image/*" className="hidden" onChange={handleEditImageChange} /></label>
                                {isLoading && <span className={`text-xs ${theme.subText}`}>処理中...</span>}
                                {editData.artistImage && (<div className={`relative w-16 h-10 overflow-hidden rounded border ${theme.divider.replace('border-', 'border-')}`}><img src={editData.artistImage} alt="preview" className="w-full h-full object-cover" /></div>)}
                            </div>
                        </div>
                    ) : (
                        <div className={`glass-panel rounded-xl overflow-hidden mb-8 shadow-xl relative ${theme.cardBg} border-0`}>
                            <div className="absolute top-0 right-0 w-32 h-32 bg-pink-500 opacity-20 rounded-full blur-3xl -mr-10 -mt-10 pointer-events-none"></div>
                            {data.artistImage && (
                                <div className="w-full h-32 overflow-hidden relative"><img src={data.artistImage} alt="artist banner" className="w-full h-full object-cover opacity-50 blur-sm" /><div className={`absolute inset-0 bg-gradient-to-t ${theme.bg.replace('bg-', 'from-')} to-transparent`}></div></div>
                            )}
                            <div className="p-6 relative z-10 -mt-12">
                                <div className="flex flex-col md:flex-row items-start md:items-end gap-4">
                                    {data.artistImage ? (<img src={data.artistImage} alt="artist logo" className={`w-24 h-24 rounded-full border-4 shadow-lg object-cover ${theme.bg} border-gray-700`} />) : (<div className={`w-24 h-24 rounded-full border-4 shadow-lg flex items-center justify-center ${theme.buttonSecondary} border-gray-300`}><IconMusic /></div>)}
                                    <div className="flex-1">
                                        <div className="flex items-center text-sm text-pink-500 mb-1 font-bold"><IconCalendar /> <span className="ml-1">{data.date}</span></div>
                                        <h2 className={`text-2xl md:text-3xl font-bold leading-tight mb-2 ${theme.text}`}>{data.title}</h2>
                                        <div className={`flex items-center text-sm ${theme.subText}`}><IconMapPin /> <span className="ml-1">{data.venue}</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    <div className="space-y-8">
                        {(isEditing ? editData.acts : data.acts).map((act, actIndex) => (
                            <div key={actIndex} className="animate-fade-in">
                                <div className="flex items-center justify-between mb-2 px-2">
                                    {isEditing ? (
                                        <div className="flex-1 mr-2"><input type="text" className={`w-full rounded p-2 outline-none text-lg font-bold ${theme.input}`} value={act.artistName} onChange={(e) => handleEditChange('artistName', e.target.value, actIndex)} placeholder="アーティスト名" /></div>
                                    ) : (
                                        <h3 className={`text-xl font-bold ${theme.text} flex items-center`}>{act.artistName} <span className={`ml-2 text-xs px-2 py-0.5 rounded border ${theme.divider} ${theme.subText}`}>{act.type}</span></h3>
                                    )}
                                    {isEditing && editData.acts.length > 1 && (<button onClick={() => removeAct(actIndex)} className="p-2 hover:bg-red-900/50 rounded text-red-400"><IconTrash2 /></button>)}
                                </div>
                                <div className={`glass-panel rounded-lg overflow-hidden ${theme.cardBg}`}>
                                    <ul className={`divide-y ${theme.isDarkMode ? 'divide-gray-800' : 'divide-gray-200'}`}>
                                        {act.songs.map((song, songIndex) => {
                                            if (isEditing) {
                                                if (song.isDivider) {
                                                    return (
                                                        <li key={song.id} className={`${theme.hoverBg} py-3 px-4 flex items-center justify-between group border-y border-pink-500/30`}>
                                                            <div className="flex-1 flex items-center justify-center text-pink-500 text-xs font-bold tracking-widest uppercase">--- Encore Separation Line ---</div>
                                                            <div className="flex items-center space-x-2 ml-4">
                                                                <button onClick={() => moveSong(actIndex, songIndex, -1)} className={`p-1.5 rounded ${theme.buttonSecondary}`}><IconChevronUp /></button>
                                                                <button onClick={() => moveSong(actIndex, songIndex, 1)} className={`p-1.5 rounded ${theme.buttonSecondary}`}><IconChevronDown /></button>
                                                            </div>
                                                        </li>
                                                    );
                                                }
                                                return (
                                                    <li key={song.id} className={`p-3 flex items-center ${theme.hoverBg} transition-colors`}>
                                                        <div className={`w-8 text-center text-xs mr-2 cursor-grab ${theme.subText}`}><IconGripVertical /></div>
                                                        <input type="text" value={song.title} onChange={(e) => handleEditChange('title', e.target.value, actIndex, songIndex)} className={`flex-1 bg-transparent border-b border-transparent focus:border-pink-500 outline-none py-1 ${theme.text}`} />
                                                        <div className="flex items-center space-x-1 ml-2">
                                                            <button onClick={() => moveSong(actIndex, songIndex, -1)} className={`p-1.5 rounded ${theme.buttonSecondary}`}><IconChevronUp /></button>
                                                            <button onClick={() => moveSong(actIndex, songIndex, 1)} className={`p-1.5 rounded ${theme.buttonSecondary}`}><IconChevronDown /></button>
                                                            <button onClick={() => removeSong(actIndex, songIndex)} className="p-1 hover:bg-red-100 rounded text-gray-400 hover:text-red-500 ml-2"><IconX /></button>
                                                        </div>
                                                    </li>
                                                );
                                            }
                                            const isExpanded = expandedSong === `${actIndex}-${songIndex}`;
                                            const isEncoreStart = String(song.order).startsWith('En') && (songIndex === 0 || !String(act.songs[songIndex - 1].order).startsWith('En'));
                                            return (
                                                <React.Fragment key={songIndex}>
                                                    {isEncoreStart && (
                                                        <div className="relative py-8 flex items-center justify-center mt-4 mb-2">
                                                            <div className="absolute inset-0 flex items-center"><div className="w-full h-0.5 bg-gradient-to-r from-transparent via-pink-500/60 to-transparent shadow-[0_0_8px_rgba(236,72,153,0.4)]"></div></div>
                                                            <div className="relative flex justify-center z-10 px-4"><span className={`text-pink-500 font-bold tracking-widest uppercase text-sm ${theme.isDarkMode ? 'bg-gray-900' : 'bg-gray-50'} px-2`}>Encore</span></div>
                                                        </div>
                                                    )}
                                                    <li className={`group transition-colors ${theme.hoverBg}`}>
                                                        <div onClick={() => toggleSong(actIndex, songIndex)} className="p-4 flex items-start cursor-pointer">
                                                            <span className={`w-10 text-right font-mono text-sm mr-4 pt-1 ${String(song.order).startsWith('En') ? 'text-pink-500 font-bold' : theme.subText}`}>{song.order}.</span>
                                                            <div className="flex-1">
                                                                <div className={`font-medium text-lg ${theme.text}`}>{song.title}</div>
                                                                {song.memo && !isExpanded && (<div className={`text-xs mt-1 flex items-center truncate ${theme.subText}`}><IconPenTool /> {song.memo}</div>)}
                                                            </div>
                                                            <div className={theme.subText}>{isExpanded ? <IconChevronUp /> : <IconChevronDown />}</div>
                                                        </div>
                                                        {isExpanded && (
                                                            <div className="px-4 pb-4 pl-14 animate-fade-in">
                                                                <div className="flex flex-wrap gap-2 mb-4">
                                                                    {getSearchLinks(act.artistName, song.title).map((link, i) => (
                                                                        <a key={i} href={link.url} target="_blank" rel="noopener noreferrer" className={`flex items-center text-xs border rounded-full px-3 py-1.5 transition-all ${link.color} ${theme.hoverBg}`}><span className="mr-1.5 w-4 h-4">{link.icon}</span>{link.name}で聴く<IconExternalLink /></a>
                                                                    ))}
                                                                </div>
                                                                <div className={`rounded-lg p-3 border ${theme.cardBg}`}>
                                                                    <div className={`flex items-center text-xs mb-2 ${theme.subText}`}><IconPenTool /> <span className="ml-1">memo</span></div>
                                                                    <textarea className={`w-full bg-transparent text-sm outline-none resize-none h-20 ${theme.text}`} placeholder="入力する..." value={song.memo || ''} onChange={(e) => handleMemoChange(actIndex, songIndex, e.target.value)} />
                                                                </div>
                                                            </div>
                                                        )}
                                                    </li>
                                                </React.Fragment>
                                            );
                                        })}
                                    </ul>
                                    {isEditing && (
                                        <button onClick={() => addSong(actIndex)} className={`w-full py-3 text-sm flex items-center justify-center transition-colors border-t ${theme.subText} ${theme.hoverBg} ${theme.isDarkMode ? 'border-gray-800' : 'border-gray-200'}`}>
                                            <IconPlusCircle /> <span className="ml-1">曲を追加</span>
                                        </button>
                                    )}
                                </div>
                            </div>
                        ))}
                        {isEditing && (
                            <button onClick={addAct} className="w-full py-4 border-2 border-dashed border-gray-600 rounded-lg text-gray-400 hover:border-pink-500 hover:text-pink-500 transition-colors flex items-center justify-center font-bold">
                                <IconPlusCircle /> <span className="ml-2">アーティストを追加（対バン等）</span>
                            </button>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>